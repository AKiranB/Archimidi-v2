(this["webpackJsonpfile-upload-client"]=this["webpackJsonpfile-upload-client"]||[]).push([[0],{130:function(e,t,n){},158:function(e,t,n){},159:function(e,t,n){"use strict";n.r(t);var a=n(0),c=n.n(a),r=n(50),s=n.n(r),i=(n(130),n(18)),o=n(6),u=n(14),l=n(16),j=n(44),b=n.n(j),d=b.a.create({baseURL:"/api"}),h=function(e){throw e},O={service:d,handleUpload:function(e){return d.post("/upload",e).then((function(e){return e.data})).catch((function(e){h("error uploading file:")}))},saveNewSong:function(e){return d.post("/songs/create",e).then((function(e){return e.data})).catch((function(e){h("error saving new song")}))},findAllSongs:function(){return d.get("/songs").then((function(e){return e.data})).catch((function(e){h("error retrieving all songs")}))},getSong:function(e){return d.get("/songs/".concat(e)).then((function(e){return e.data})).catch((function(e){h("error retrieving song:")}))},signup:function(e,t){return d.post("/auth/signup",{username:e,password:t}).then((function(e){return e.data})).catch((function(e){return e.response.data}))},login:function(e,t){return d.post("/auth/login",{username:e,password:t}).then((function(e){return e.data})).catch((function(e){return e.response.data}))},logout:function(){return d.delete("/auth/logout").then((function(e){return e.data})).catch((function(e){return e.response.data}))},errorHandler:h,deleteSong:function(e){return d.delete("/".concat(e)).then((function(e){return e.data})).catch((function(e){h("error deleting song:")}))}},f=n(203),x=n(209),p=n(1);var g=function(e){var t=Object(u.f)(),n=e.user._id,c=Object(a.useState)(""),r=Object(o.a)(c,2),s=r[0],i=r[1],j=Object(a.useState)(""),b=Object(o.a)(j,2),d=b[0],h=b[1],g=Object(a.useState)(""),m=Object(o.a)(g,2),v=m[0],y=m[1],S=Object(a.useState)(n),k=Object(o.a)(S,1)[0],N=Object(a.useState)(""),C=Object(o.a)(N,2),w=C[0],U=C[1],I=Object(a.useState)([]),B=Object(o.a)(I,2),F=B[0],A=B[1],E=Object(a.useState)(null),_=Object(o.a)(E,2),D=_[0],L=_[1],T=Object(a.useState)(0),M=Object(o.a)(T,2),z=M[0],R=M[1],P=Object(a.useState)(null),J=Object(o.a)(P,2),Z=J[0],H=J[1],W=Object(p.jsx)(x.a,{variant:"contained",className:"bottomMargin",type:"submit",children:"Save new song"}),Y=Object(p.jsx)("p",{children:"Loading"}),q=Object(p.jsx)("p",{style:{fontSize:15},children:"Waiting for file..."});Object(a.useEffect)((function(){return null!==D&&A(Object(l.a)(F).filter((function(e){return e!==D}))),function(){L(null)}}),[D,F]);var G=function(e){e.preventDefault(),L(e.target.tagButton.value)};return Object(a.useEffect)((function(){F.length>=5&&H("max tags number: 5")}),[F]),Object(p.jsxs)("div",{className:"secondaryContainer",children:[Object(p.jsx)("h2",{children:"Add a New MIDI song"}),Object(p.jsxs)("form",{onSubmit:function(e){e.preventDefault(),s.length>0?O.saveNewSong({title:s,author:d,songUrl:v,createdBy:k,tags:F}).then((function(e){t.push("/songs/".concat(e._id))})).catch((function(e){return console.log("Error while adding the new song: ",e)})):H("enter a title")},className:"baseForm",children:[Object(p.jsx)(f.a,{type:"text",name:"title",value:s,onChange:function(e){return i(e.target.value)},id:"outlined-basic",label:"Title",variant:"outlined",placeholder:"Title",className:"Input"}),Object(p.jsx)(f.a,{className:"Input",type:"text",name:"author",value:d,onChange:function(e){return h(e.target.value)},id:"outlined-basic",label:"Author",variant:"outlined",placeholder:"Author"}),Object(p.jsxs)("div",{children:[Object(p.jsxs)("label",{className:"fileUpload",children:["Choose a file",Object(p.jsx)("input",{type:"file",onChange:function(e){R(1);var t=new FormData;t.append("songUrl",e.target.files[0]),O.handleUpload(t).then((function(e){y(e.secure_url),R(2)})).catch((function(e){return console.log("Error while uploading the file: ",e)}))}})]}),Object(p.jsx)("div",{children:z>1?W:z>0?Y:q})]})]}),F.length<5&&Object(p.jsxs)("form",{onSubmit:function(e){e.preventDefault(),H(null),A((function(e){return[w].concat(Object(l.a)(e)).map((function(e){return e.toLowerCase()})).filter((function(e,t,n){return""===e?(H("cannot add an empty tag"),!1):n.indexOf(e)===t||(H("".concat(e," is already a tag")),!1)}))})),U("")},className:"baseForm",children:[Object(p.jsx)(f.a,{type:"text",name:"tag",value:w,placeholder:"Add tags",onChange:function(e){return U(e.target.value)}}),Object(p.jsx)(x.a,{type:"submit",children:"Add"})]}),Z&&Object(p.jsx)("p",{children:Z}),Object(p.jsx)("div",{className:"tagsBox",children:F.map((function(e,t){return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("p",{children:e}),Object(p.jsx)("form",{onSubmit:G,children:Object(p.jsx)(x.a,{name:"tagButton",type:"submit",value:e,children:"x"})})]})}))})]})},m=n(69),v=n(35),y=n.n(v),S=n(48),k=(n(158),n(21)),N=n(114),C=n.n(N),w=n(96),U=n.n(w),I=n(115),B=n.n(I);function F(e){var t=e.title,n=e._id,c=e.songUrl,r=e.author,s=e.tags,i=e.likes,u=e.user,l=e.likedUsers,j=Object(a.useState)({title:t,_id:n,songUrl:c,author:r,tags:s,likes:i,likedUsers:l}),d=Object(o.a)(j,2),h=d[0],O=d[1],f=u?u._id:"",x=n;return Object(p.jsxs)("div",{className:"songCard",children:[Object(p.jsx)(k.b,{className:"Link",to:"/songs/".concat(n),children:Object(p.jsxs)("div",{className:"cardTop",children:[Object(p.jsx)("h3",{children:h.title}),Object(p.jsxs)("h4",{children:["By ",h.author]})]})}),Object(p.jsx)("div",{className:"tagsBox",children:s&&s.map((function(e,t){return Object(p.jsx)("p",{children:e},t)}))}),Object(p.jsxs)("div",{className:"likeAndDownloadContainer",children:[Object(p.jsx)("a",{href:c,download:"".concat(h.title,"_").concat(h.author,".mid"),children:Object(p.jsx)(C.a,{className:"customButton"})}),""!==f?Object(p.jsx)("div",{children:h.likedUsers.includes(f)?Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(U.a,{id:"heartIcon",className:"customButton",onClick:function(){b.a.put("/api/unlike/".concat(x),{currentUserId:f}).then((function(e){O(e.data)})).catch((function(e){throw new Error("Cannot update likes:",e)}))}}),h.likes]}):Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(B.a,{id:"heartIcon",className:"customButton",onClick:function(){b.a.put("/api/like/".concat(x),{currentUserId:f}).then((function(e){O(e.data)})).catch((function(e){throw new Error("Cannot update likes:",e)}))}}),h.likes]})}):Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)(U.a,{id:"heartIcon",className:"customButton"}),h.likes]})]})]},n)}var A=n(206),E=n(207),_=n(210),D=n(212),L=n(211),T=n(97),M=n.n(T);var z=function(e){var t=Object(a.useState)([]),n=Object(o.a)(t,2),c=n[0],r=n[1],s=Object(a.useState)([]),u=Object(o.a)(s,2),j=u[0],b=u[1],d=e.search,h=Object(a.useState)({title:!0,author:!0,tags:!1}),f=Object(o.a)(h,2),x=f[0],g=f[1],v=Object(a.useState)({alphabetic:!1,likes:!1}),k=Object(o.a)(v,2),N=k[0],C=k[1],w=function(){var e=Object(S.a)(y.a.mark((function e(){var t;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.findAllSongs();case 2:t=e.sent,r(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){w()}),[]);var U=d.split(" ")||[];function I(e){var t=1;return"-"===e[0]&&(t=-1,e=e.substr(1)),function(n,a){return(n[e]<a[e]?-1:n[e]>a[e]?1:0)*t}}function B(e,t){for(var n=0;n<=t.length;n++)if(t.substring(n,n+e.length).toLowerCase()===e.toLowerCase())return!0;return!1}Object(a.useEffect)((function(){!function(e){var t,n=Object(l.a)(e);N.alphabetic||N.likes?N.alphabetic?(t=n.sort(I("title")),b(t)):N.likes?(t=n.sort(I("-likes")),b(t)):(t=n.sort((function(e,t){return e.title-t.title||e.likes-t.likes})),b(t)):b(e)}(c)}),[N,c]);var T=j.filter((function(e){var t,n=e.title.split(" "),a=e.author.split(" "),c=Object(l.a)(e.tags),r=Object(m.a)(U);try{for(r.s();!(t=r.n()).done;){var s=t.value;if(!0===x.title){var i,o=Object(m.a)(n);try{for(o.s();!(i=o.n()).done;){if(B(s,i.value))return!0}}catch(h){o.e(h)}finally{o.f()}}if(!0===x.author){var u,j=Object(m.a)(a);try{for(j.s();!(u=j.n()).done;){if(B(s,u.value))return!0}}catch(h){j.e(h)}finally{j.f()}}if(!0===x.tags){var b,d=Object(m.a)(c);try{for(d.s();!(b=d.n()).done;){if(B(s,b.value))return!0}}catch(h){d.e(h)}finally{d.f()}}return!1}}catch(h){r.e(h)}finally{r.f()}return!0})),z=Object(p.jsxs)("div",{className:"searchTickBoxesContainer",children:[Object(p.jsxs)("label",{children:["Title",Object(p.jsx)(A.a,{name:"",type:"checkbox",checked:x.title,onChange:function(e){return g(Object(i.a)(Object(i.a)({},x),{},{title:e.target.checked}))}})]}),Object(p.jsx)("br",{}),Object(p.jsxs)("label",{children:["Author",Object(p.jsx)(A.a,{name:"author",type:"checkbox",checked:x.author,onChange:function(e){return g(Object(i.a)(Object(i.a)({},x),{},{author:e.target.checked}))}})]}),Object(p.jsx)("br",{}),Object(p.jsxs)("label",{children:["Tags",Object(p.jsx)(A.a,{name:"tags",type:"checkbox",checked:x.tags,onChange:function(e){return g(Object(i.a)(Object(i.a)({},x),{},{tags:e.target.checked}))}})]}),Object(p.jsx)("br",{})]}),R=Object(p.jsxs)("div",{className:"sortTickBoxesContainer",children:[Object(p.jsxs)("label",{children:["A-Z",Object(p.jsx)(A.a,{name:"A-Z",type:"checkbox",checked:N.alphabetic,onChange:function(e){return C(Object(i.a)(Object(i.a)({},N),{},{alphabetic:e.target.checked}))}})]}),Object(p.jsx)("br",{}),Object(p.jsxs)("label",{children:["Most favourited",Object(p.jsx)(A.a,{name:"likes",type:"checkbox",checked:N.likes,onChange:function(e){return C(Object(i.a)(Object(i.a)({},N),{},{likes:e.target.checked}))}})]})]});return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsxs)("div",{className:"accordionContainer",children:[Object(p.jsxs)(E.a,{color:"black",children:[Object(p.jsx)(_.a,{expandIcon:Object(p.jsx)(M.a,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:Object(p.jsx)(L.a,{children:"Search by"})}),Object(p.jsx)(D.a,{children:Object(p.jsx)(L.a,{component:"span",children:z})})]}),Object(p.jsxs)(E.a,{color:"black",children:[Object(p.jsx)(_.a,{expandIcon:Object(p.jsx)(M.a,{}),"aria-controls":"panel1a-content",id:"panel1a-header",children:Object(p.jsx)(L.a,{children:"Sort by"})}),Object(p.jsx)(D.a,{children:Object(p.jsx)(L.a,{component:"span",children:R})})]})]}),Object(p.jsx)("div",{className:"songsListContainer",children:T.length>0?T.map((function(t){return Object(p.jsx)(F,Object(i.a)({className:"songCard",user:e.user},t),t._id)})):Object(p.jsx)("p",{children:" No songs match your search"})})]})},R=n(214),P=n(116),J=n.n(P),Z=n(204),H=n(213),W=n(216);function Y(e){var t=c.a.useState(0),n=Object(o.a)(t,2),a=n[0],r=n[1],s=function(e,t){r(t)},i=Object(u.f)(),l=e.search,j=e.setSearch,b=Object(p.jsxs)("form",{className:"searchBar",children:[Object(p.jsx)(R.a,{type:"search",name:"search",value:l,onChange:function(e){return j(e.target.value)},placeholder:"Type your search here"}),Object(p.jsxs)("button",{onClick:function(e){e.preventDefault(),i.push("/")},children:[" ",Object(p.jsx)(J.a,{})]})]});return Object(p.jsxs)(W.a,{className:"navBar",children:[e.user?Object(p.jsx)("div",{className:"navRight",children:Object(p.jsxs)(Z.a,{value:a,onChange:s,style:{width:700},children:[Object(p.jsx)(H.a,{label:"Archimidi",id:"logo",component:k.b,to:"/"}),Object(p.jsx)(H.a,{to:"/",label:"Logout",onClick:function(){O.logout().then((function(){i.push("/"),e.setUser(null)}))}}),Object(p.jsx)(H.a,{component:k.b,to:"/songs/add",label:"Upload Song"}),Object(p.jsx)(H.a,{component:k.b,to:"/mysongs",label:"My Songs"})]})}):Object(p.jsx)("div",{className:"navRight",children:Object(p.jsxs)(Z.a,{value:a,onChange:s,children:[Object(p.jsx)(H.a,{label:"Archimidi",id:"logo",component:k.b,to:"/"}),Object(p.jsx)(H.a,{label:"login",component:k.b,to:"/login"}),Object(p.jsx)(H.a,{component:k.b,label:"Sign up",to:"/signup"})]})}),b]})}function q(e){var t=Object(a.useState)(null),n=Object(o.a)(t,2),c=n[0],r=n[1],s=Object(a.useState)({body:null}),l=Object(o.a)(s,2),j=l[0],b=l[1],d=Object(u.f)(),h=e.user?e.user._id:"",f=e.match.params.id;return Object(a.useEffect)((function(){var e=function(){var e=Object(S.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.getSong(t);case 2:n=e.sent,r(n);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();e(f)}),[f]),Object(a.useEffect)((function(){var e=document.createElement("script");return e.src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.22.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.4.0",e.async=!0,document.body.appendChild(e),function(){document.body.removeChild(e)}}),[]),Object(a.useEffect)((function(){c&&b({body:Object(p.jsx)(p.Fragment,{children:Object(p.jsxs)("section",{id:"player2",children:[Object(p.jsx)("midi-player",{src:c.songUrl,visualizer:"#player2 midi-visualizer"}),Object(p.jsx)("midi-visualizer",{type:"piano-roll",src:c.songUrl})]})})})}),[c]),Object(p.jsxs)("div",{className:"detailsContainer",children:[""===h&&Object(p.jsx)(k.b,{to:"/login",style:{},children:Object(p.jsx)("div",{children:"Log in to add this MIDI song to your favourites"})}),c&&Object(p.jsxs)("div",{className:"baseForm",children:[Object(p.jsx)(F,Object(i.a)({id:"songCardDetails",user:e.user},c),c._id),Object(p.jsxs)("div",{children:[h===c.createdBy&&Object(p.jsxs)(x.a,{variant:"contained",onClick:function(){return function(e){try{O.deleteSong(e),d.push("/")}catch(t){return console.log(t)}}(c._id)},children:['Delete "',c.title,'"']}),h===c.createdBy&&Object(p.jsx)(k.b,{to:"/songs/edit/".concat(c._id),children:Object(p.jsxs)(x.a,{style:{marginLeft:30},variant:"contained",children:['Edit "',c.title,'"']})})]}),null!==j.body?Object(p.jsx)("div",{children:j.body}):Object(p.jsx)("p",{children:"There's nothing to play"})]})]})}function G(e){var t=Object(a.useState)(""),n=Object(o.a)(t,2),c=n[0],r=n[1],s=Object(a.useState)(""),i=Object(o.a)(s,2),u=i[0],l=i[1],j=Object(a.useState)(""),b=Object(o.a)(j,2),d=b[0],h=b[1];return Object(p.jsxs)("div",{className:"secondaryContainer",children:[Object(p.jsx)("h3",{children:"Sign up"}),Object(p.jsxs)("form",{onSubmit:function(t){t.preventDefault(),O.signup(c,u).then((function(t){t.message?(r(""),l(""),h(t.message)):(e.setUser(t),e.history.push("/"))})).catch((function(e){return console.log(e)}))},className:"baseForm",children:[Object(p.jsx)(f.a,{type:"text",name:"username",value:c,onChange:function(e){return r(e.target.value)},className:"Input",error:!!d,label:"Username",variant:"outlined"}),Object(p.jsx)(f.a,{type:"password",name:"password",value:u,onChange:function(e){return l(e.target.value)},className:"Input",error:!!d,label:"Password",variant:"outlined"}),Object(p.jsx)(x.a,{variant:"contained",type:"submit",children:"Create Account "}),d&&Object(p.jsx)("h3",{children:d})]})]})}function K(e){var t=Object(a.useState)(""),n=Object(o.a)(t,2),c=n[0],r=n[1],s=Object(a.useState)(""),i=Object(o.a)(s,2),u=i[0],l=i[1],j=Object(a.useState)(""),b=Object(o.a)(j,2),d=b[0],h=b[1];return Object(p.jsxs)("div",{className:"secondaryContainer",children:[Object(p.jsx)("h3",{children:"Log in"}),Object(p.jsxs)("form",{onSubmit:function(t){t.preventDefault(),O.login(c,u).then((function(t){t.message?(h(t.message),r(""),l("")):(e.setUser(t),e.history.push("/"))})).catch((function(e){console.log(e)}))},className:"baseForm",children:[Object(p.jsx)(f.a,{type:"text",name:"username",value:c,onChange:function(e){return r(e.target.value)},className:"Input",error:!!d,label:"Username",variant:"outlined",style:{color:"grey"}}),Object(p.jsx)(f.a,{type:"password",name:"password",value:u,onChange:function(e){return l(e.target.value)},className:"Input",label:"Password",variant:"outlined",error:!!d}),Object(p.jsx)(x.a,{variant:"contained",type:"submit",children:"Log in"}),d&&Object(p.jsx)("h3",{children:d})]})]})}function Q(e){var t=e.user._id||"",n=Object(a.useState)([]),c=Object(o.a)(n,2),r=c[0],s=c[1],u=function(){var e=Object(S.a)(y.a.mark((function e(){var t;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.findAllSongs();case 2:t=e.sent,s(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(a.useEffect)((function(){u()}),[]);var l=r.filter((function(e){return e.createdBy===t}));return Object(p.jsx)("div",{children:void 0!==t?Object(p.jsx)(p.Fragment,{children:Object(p.jsx)("div",{className:"songsListContainer",children:l.length>=1?Object(p.jsx)(p.Fragment,{children:l.map((function(e){return Object(p.jsx)(F,Object(i.a)({},e),e._id)}))}):Object(p.jsx)(p.Fragment,{children:Object(p.jsx)("h1",{children:"You haven't uploaded any songs yet"})})})}):null})}function V(e){var t=Object(a.useState)(""),n=Object(o.a)(t,2),c=n[0],r=n[1],s=Object(a.useState)(""),i=Object(o.a)(s,2),u=i[0],l=i[1],j=e.match.params.id;Object(a.useEffect)((function(){var e=function(){var e=Object(S.a)(y.a.mark((function e(t){var n;return y.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,O.getSong(t);case 2:n=e.sent,r(n.title),l(n.author);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();e(j)}),[j]);return Object(p.jsxs)("div",{className:"secondaryContainer",children:[Object(p.jsx)("h3",{children:"Edit song"}),Object(p.jsxs)("form",{onSubmit:function(t){t.preventDefault();var n={title:c,author:u};b.a.put("/api/".concat(j),n).then((function(){e.history.push("/songs/".concat(j))})).catch((function(e){return console.log(e)}))},className:"baseForm",children:[Object(p.jsx)(f.a,{type:"text",name:"title",value:c,onChange:function(e){return r(e.target.value)},className:"Input",label:"Title",variant:"outlined"}),Object(p.jsx)(f.a,{type:"text",name:"author",value:u,onChange:function(e){return l(e.target.value)},className:"Input",label:"Author",variant:"outlined"}),Object(p.jsx)(x.a,{variant:"contained",type:"submit",children:"Update this project"})]})]})}var X=function(e){var t=Object(a.useState)(e.search),n=Object(o.a)(t,2),c=n[0],r=n[1],s=Object(a.useState)(e.user),l=Object(o.a)(s,2),j=l[0],b=l[1],d=function(e){b(e)};return Object(p.jsxs)("div",{className:"App",children:[Object(p.jsx)(Y,{user:j,setUser:b,search:c,setSearch:r,currentPage:e}),Object(p.jsx)("div",{className:"mainContainer",children:Object(p.jsxs)(u.c,{children:[Object(p.jsx)(u.a,{exact:!0,path:"/",render:function(e){return Object(p.jsx)(z,{search:c,setSearch:r,user:j})}}),Object(p.jsx)(u.a,{exact:!0,path:"/songs/add",render:j?function(e){return Object(p.jsx)(g,{user:j,setUser:b})}:function(e){return Object(p.jsx)(K,Object(i.a)({setUser:d},e))}}),Object(p.jsx)(u.a,{exact:!0,path:"/songs/:id",render:j?function(e){return Object(p.jsx)(q,Object(i.a)({user:j},e))}:function(e){return Object(p.jsx)(q,Object(i.a)({user:null},e))}}),Object(p.jsx)(u.a,{exact:!0,path:"/signup",render:function(e){return Object(p.jsx)(G,Object(i.a)({setUser:d},e))}}),Object(p.jsx)(u.a,{exact:!0,path:"/login",render:function(e){return Object(p.jsx)(K,Object(i.a)({setUser:d},e))}}),Object(p.jsx)(u.a,{exact:!0,path:"/mysongs",render:function(e){return Object(p.jsx)(Q,{user:j,setUser:b})}}),Object(p.jsx)(u.a,{exact:!0,path:"/songs/edit/:id",component:V}),Object(p.jsx)(u.a,{component:function(){return Object(p.jsxs)(p.Fragment,{children:[Object(p.jsx)("h1",{children:"404 - Not Found"}),"  ",Object(p.jsx)(k.b,{to:"/",children:"Return home"})]})}}),"2"]})})]})};b.a.get("/api/auth/loggedin").then((function(e){var t=e.data;s.a.render(Object(p.jsx)(k.a,{children:Object(p.jsx)(X,{user:t,search:""})}),document.getElementById("root"))}))}},[[159,1,2]]]);
//# sourceMappingURL=main.a0ad4716.chunk.js.map