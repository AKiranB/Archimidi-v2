(this["webpackJsonpfile-upload-client"]=this["webpackJsonpfile-upload-client"]||[]).push([[0],{40:function(e,t,n){},67:function(e,t,n){},68:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n(33),a=n.n(r),s=(n(40),n(5)),i=n(2),o=n(3),u=n(18),l=n(12),j=n.n(l),b=j.a.create({baseURL:"/api"}),h=function(e){throw e},d={service:b,handleUpload:function(e){return b.post("/upload",e).then((function(e){return e.data})).catch((function(e){h("error uploading file:")}))},saveNewSong:function(e){return b.post("/songs/create",e).then((function(e){return e.data})).catch((function(e){h("error saving new song")}))},findAllSongs:function(){return b.get("/songs").then((function(e){return e.data})).catch((function(e){h("error retrieving all songs")}))},getSong:function(e){return b.get("/songs/".concat(e)).then((function(e){return e.data})).catch((function(e){h("error retrieving song:")}))},signup:function(e,t){return b.post("/auth/signup",{username:e,password:t}).then((function(e){return e.data})).catch((function(e){return e.response.data}))},login:function(e,t){return b.post("/auth/login",{username:e,password:t}).then((function(e){return e.data})).catch((function(e){return e.response.data}))},logout:function(){return b.delete("/auth/logout").then((function(e){return e.data})).catch((function(e){return e.response.data}))},errorHandler:h,deleteSong:function(e){return b.delete("/".concat(e)).then((function(e){return e.data})).catch((function(e){h("error deleting song:")}))}},O=n(0);var f=function(e){var t=Object(o.f)(),n=e.user._id,r=Object(c.useState)(""),a=Object(i.a)(r,2),s=a[0],l=a[1],j=Object(c.useState)(""),b=Object(i.a)(j,2),h=b[0],f=b[1],p=Object(c.useState)(""),g=Object(i.a)(p,2),x=g[0],m=g[1],v=Object(c.useState)(n),y=Object(i.a)(v,1)[0],S=Object(c.useState)(""),w=Object(i.a)(S,2),N=w[0],C=w[1],k=Object(c.useState)([]),U=Object(i.a)(k,2),F=U[0],E=U[1],L=Object(c.useState)(null),D=Object(i.a)(L,2),_=D[0],A=D[1],B=Object(c.useState)(0),I=Object(i.a)(B,2),M=I[0],T=I[1],z=Object(c.useState)(null),P=Object(i.a)(z,2),J=P[0],R=P[1],H=Object(O.jsx)("button",{className:"bottomMargin",type:"submit",children:"Save new song"}),W=Object(O.jsx)("p",{children:"Loading"}),Y=Object(O.jsx)("p",{children:"Waiting for a file..."});Object(c.useEffect)((function(){return null!==_&&E(Object(u.a)(F).filter((function(e){return e!==_}))),function(){A(null)}}),[_,F]);var q=function(e){e.preventDefault(),A(e.target.tagButton.value)};return Object(c.useEffect)((function(){F.length>=5&&R("max tags number: 5")}),[F]),Object(O.jsxs)("div",{className:"secondaryContainer",children:[Object(O.jsx)("h2",{children:"New Song"}),Object(O.jsxs)("form",{onSubmit:function(e){e.preventDefault(),s.length>0?d.saveNewSong({title:s,author:h,songUrl:x,createdBy:y,tags:F}).then((function(e){t.push("/songs/".concat(e._id))})).catch((function(e){return console.log("Error while adding the new song: ",e)})):R("enter a title")},className:"baseForm",children:[Object(O.jsx)("input",{type:"text",name:"title",value:s,onChange:function(e){return l(e.target.value)},placeholder:"Title"}),Object(O.jsx)("input",{className:"bottomMargin",type:"text",name:"author",value:h,onChange:function(e){return f(e.target.value)},placeholder:"Author"}),Object(O.jsxs)("div",{children:[Object(O.jsxs)("label",{className:"fileUpload",children:["Choose a file",Object(O.jsx)("input",{type:"file",onChange:function(e){T(1);var t=new FormData;t.append("songUrl",e.target.files[0]),d.handleUpload(t).then((function(e){m(e.secure_url),T(2)})).catch((function(e){return console.log("Error while uploading the file: ",e)}))}})]}),Object(O.jsx)("div",{children:M>1?H:M>0?W:Y})]})]}),F.length<5&&Object(O.jsxs)("form",{onSubmit:function(e){e.preventDefault(),R(null),E((function(e){return[N].concat(Object(u.a)(e)).map((function(e){return e.toLowerCase()})).filter((function(e,t,n){return""===e?(R("cannot add an empty tag"),!1):n.indexOf(e)===t||(R("".concat(e," is already a tag")),!1)}))})),C("")},className:"baseForm",children:[Object(O.jsx)("input",{type:"text",name:"tag",value:N,placeholder:"Add tags",onChange:function(e){return C(e.target.value)}}),Object(O.jsx)("button",{type:"submit",children:"Add"})]}),J&&Object(O.jsx)("p",{children:J}),Object(O.jsx)("div",{className:"tagsBox",children:F.map((function(e){return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("p",{children:e}),Object(O.jsx)("form",{onSubmit:q,children:Object(O.jsx)("button",{name:"tagButton",type:"submit",value:e,children:"x"})})]})}))})]})},p=n(19),g=n(11),x=n.n(g),m=n(13),v=(n(67),n(6));function y(e){var t=e.title,n=e._id,c=e.songUrl,r=e.author,a=e.tags,s=e.likes;return Object(O.jsxs)("div",{className:"songCard",children:[Object(O.jsxs)(v.b,{className:"Link",to:"/songs/".concat(n),children:[Object(O.jsx)("h3",{children:t}),Object(O.jsx)("h4",{children:r})]}),Object(O.jsx)("div",{className:"tagsBox",children:a&&a.map((function(e,t){return Object(O.jsx)("p",{children:e},t)}))}),Object(O.jsxs)("div",{children:[s," likes"]}),Object(O.jsx)("a",{href:c,download:"".concat(t,"_").concat(r,".mid"),children:"Download"})]},n)}var S=function(e){var t=Object(c.useState)([]),n=Object(i.a)(t,2),r=n[0],a=n[1],o=e.search,l=Object(c.useState)({title:!0,author:!0,tags:!1}),j=Object(i.a)(l,2),b=j[0],h=j[1],f=function(){var e=Object(m.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.findAllSongs();case 2:t=e.sent,a(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(c.useEffect)((function(){f()}),[]);var g=o.split(" ")||[];function v(e,t){for(var n=0;n<=t.length;n++)if(t.substring(n,n+e.length).toLowerCase()===e.toLowerCase())return!0;return!1}var S=r.filter((function(e){var t,n=e.title.split(" "),c=e.author.split(" "),r=Object(u.a)(e.tags),a=Object(p.a)(g);try{for(a.s();!(t=a.n()).done;){var s=t.value;if(!0===b.title){var i,o=Object(p.a)(n);try{for(o.s();!(i=o.n()).done;){if(v(s,i.value))return!0}}catch(O){o.e(O)}finally{o.f()}}if(!0===b.author){var l,j=Object(p.a)(c);try{for(j.s();!(l=j.n()).done;){if(v(s,l.value))return!0}}catch(O){j.e(O)}finally{j.f()}}if(!0===b.tags){var h,d=Object(p.a)(r);try{for(d.s();!(h=d.n()).done;){if(v(s,h.value))return!0}}catch(O){d.e(O)}finally{d.f()}}return!1}}catch(O){a.e(O)}finally{a.f()}return!0}));return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsxs)("label",{children:["Search by title",Object(O.jsx)("input",{name:"title",type:"checkbox",checked:b.title,onChange:function(e){return h(Object(s.a)(Object(s.a)({},b),{},{title:e.target.checked}))}})]}),Object(O.jsx)("br",{}),Object(O.jsxs)("label",{children:["Search by Author",Object(O.jsx)("input",{name:"author",type:"checkbox",checked:b.author,onChange:function(e){return h(Object(s.a)(Object(s.a)({},b),{},{author:e.target.checked}))}})]}),Object(O.jsx)("br",{}),Object(O.jsxs)("label",{children:["Search through the tags",Object(O.jsx)("input",{name:"tags",type:"checkbox",checked:b.tags,onChange:function(e){return h(Object(s.a)(Object(s.a)({},b),{},{tags:e.target.checked}))}})]}),Object(O.jsx)("br",{}),Object(O.jsx)("div",{className:"songsListContainer",children:S.length>0?S.map((function(e){return Object(O.jsx)(y,Object(s.a)({className:"songCard"},e),e._id)})):Object(O.jsx)("p",{children:" No songs match your search"})})]})};function w(e){var t=Object(o.g)().pathname,n=Object(o.f)(),c=e.search,r=e.setSearch,a=Object(O.jsxs)("form",{className:"searchBar",children:[Object(O.jsx)("input",{type:"search",name:"search",value:c,onChange:function(e){return r(e.target.value)},placeholder:"Type your search here"}),"/"!==t&&Object(O.jsx)("button",{onClick:function(e){e.preventDefault(),n.push("/")},children:" Search  "})]});return Object(O.jsxs)("nav",{className:"navBar",children:[Object(O.jsxs)("div",{className:"leftNav",children:[Object(O.jsx)(v.b,{to:"/",children:Object(O.jsx)("p",{children:"ArchiMIDI"})}),a]}),e.user?Object(O.jsxs)("div",{className:"rightNav",children:[Object(O.jsx)(v.b,{to:"/",onClick:function(){d.logout().then((function(){e.setUser(null)}))},children:Object(O.jsx)("p",{children:"Logout"})}),"/songs/add"!==t&&Object(O.jsx)(v.b,{to:"/songs/add",children:Object(O.jsx)("p",{children:"Upload Song"})}),Object(O.jsx)(v.b,{to:"/mysongs",children:Object(O.jsx)("p",{children:"My songs"})})]}):Object(O.jsxs)("div",{className:"rightNav",children:["/login"===t&&Object(O.jsx)("p",{children:"Don't have an account?"}),"/signup"!==t&&Object(O.jsx)(O.Fragment,{children:Object(O.jsx)(v.b,{to:"/signup",children:Object(O.jsx)("p",{children:"Sign up"})})}),"/signup"!==t&&"/login"!==t&&Object(O.jsx)("p",{children:"or"}),"/signup"===t&&Object(O.jsx)("p",{children:"Already a user?"}),"/login"!==t&&Object(O.jsx)(v.b,{to:"/login",children:Object(O.jsx)("p",{children:"Log in"})}),"/signup"!==t&&"/login"!==t&&Object(O.jsx)("p",{children:"To upload a song "})]})]})}function N(e){var t=Object(c.useState)(null),n=Object(i.a)(t,2),r=n[0],a=n[1],u=Object(c.useState)({body:null}),l=Object(i.a)(u,2),b=l[0],h=l[1],f=Object(o.f)(),p=e.user?e.user._id:"",g=e.match.params.id;return Object(c.useEffect)((function(){var e=function(){var e=Object(m.a)(x.a.mark((function e(t){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.getSong(t);case 3:n=e.sent,a(n),e.next=11;break;case 7:return e.prev=7,e.t0=e.catch(0),f.push("/404"),e.abrupt("return",console.log(e.t0));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(t){return e.apply(this,arguments)}}();e(g)}),[g,f]),Object(c.useEffect)((function(){var e=document.createElement("script");return e.src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.22.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.4.0",e.async=!0,document.body.appendChild(e),function(){document.body.removeChild(e)}}),[]),Object(c.useEffect)((function(){r&&h({body:Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("section",{id:"player2",children:[Object(O.jsx)("midi-player",{src:r.songUrl,visualizer:"#player2 midi-visualizer"}),Object(O.jsx)("midi-visualizer",{type:"piano-roll",src:r.songUrl})]})})})}),[r]),Object(O.jsxs)("div",{className:"secondaryContainer",children:[""===p&&Object(O.jsx)(v.b,{to:"/login",children:Object(O.jsx)("div",{style:{color:"red"},children:"Log in to download and like this MIDI song"})}),r&&Object(O.jsxs)("div",{className:"baseForm",children:[Object(O.jsx)(y,Object(s.a)({className:"songCard"},r),r._id),Object(O.jsxs)("div",{children:[p===r.createdBy&&Object(O.jsxs)("button",{onClick:function(){return function(e){try{d.deleteSong(e),f.push("/")}catch(t){return console.log(t)}}(r._id)},children:["Delete ",r.title]}),p===r.createdBy&&Object(O.jsx)(v.b,{to:"/songs/edit/".concat(r._id),children:Object(O.jsxs)("button",{children:["Edit ",r.title]})})]}),null!==b.body?Object(O.jsx)("div",{children:b.body}):Object(O.jsx)("p",{children:"There's nothing to play"}),""!==p&&Object(O.jsx)("div",{children:r.likedUsers.includes(p)?Object(O.jsx)("button",{onClick:function(){j.a.put("/api/unlike/".concat(g),{currentUserId:p}).then((function(e){a(e.data)})).catch((function(e){throw new Error("cannot update likes")}))},children:"Unlike this song"}):Object(O.jsx)("button",{onClick:function(){j.a.put("/api/like/".concat(g),{currentUserId:p}).then((function(e){a(e.data)})).catch((function(e){throw new Error("cannot update likes")}))},children:"Like this song"})})]})]})}function C(e){var t=Object(c.useState)(""),n=Object(i.a)(t,2),r=n[0],a=n[1],s=Object(c.useState)(""),o=Object(i.a)(s,2),u=o[0],l=o[1],j=Object(c.useState)(""),b=Object(i.a)(j,2),h=b[0],f=b[1];return Object(O.jsxs)("div",{className:"secondaryContainer",children:[Object(O.jsx)("h3",{children:"Sign up"}),Object(O.jsxs)("form",{onSubmit:function(t){t.preventDefault(),d.signup(r,u).then((function(t){t.message?(a(""),l(""),f(t.message)):(e.setUser(t),e.history.push("/"))})).catch((function(e){return console.log(e)}))},className:"baseForm",children:[Object(O.jsx)("label",{htmlFor:"username",children:"Username: "}),Object(O.jsx)("input",{type:"text",name:"username",value:r,onChange:function(e){return a(e.target.value)}}),Object(O.jsx)("label",{htmlFor:"password",children:"Password: "}),Object(O.jsx)("input",{type:"password",name:"password",value:u,onChange:function(e){return l(e.target.value)}}),Object(O.jsx)("button",{type:"submit",children:"Sign Up \u270d\ufe0f"}),h&&Object(O.jsx)("h3",{children:h})]})]})}function k(e){var t=Object(c.useState)(""),n=Object(i.a)(t,2),r=n[0],a=n[1],s=Object(c.useState)(""),o=Object(i.a)(s,2),u=o[0],l=o[1],j=Object(c.useState)(""),b=Object(i.a)(j,2),h=b[0],f=b[1];return Object(O.jsxs)("div",{className:"secondaryContainer",children:[Object(O.jsx)("h3",{children:"Log in"}),Object(O.jsxs)("form",{onSubmit:function(t){t.preventDefault(),d.login(r,u).then((function(t){console.log("handlesubmit service.login response:",t),t.message?(f(t.message),a(""),l("")):(e.setUser(t),e.history.push("/"))}))},className:"baseForm",children:[Object(O.jsx)("label",{htmlFor:"username",children:"Username: "}),Object(O.jsx)("input",{type:"text",name:"username",value:r,onChange:function(e){return a(e.target.value)}}),Object(O.jsx)("label",{htmlFor:"password",children:"Password: "}),Object(O.jsx)("input",{type:"password",name:"password",value:u,onChange:function(e){return l(e.target.value)}}),Object(O.jsx)("button",{type:"submit",children:"Log in\u270d\ufe0f"}),h&&Object(O.jsx)("h3",{children:h})]})]})}function U(e){var t=Object(c.useState)([]),n=Object(i.a)(t,2),r=n[0],a=n[1],o=function(){var e=Object(m.a)(x.a.mark((function e(){var t;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.findAllSongs();case 2:t=e.sent,a(t);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();Object(c.useEffect)((function(){o()}),[]);var u=r.filter((function(t){return t.createdBy===e.user._id}));return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("h3",{children:"My Songs"}),Object(O.jsx)("div",{className:"songsListContainer",children:u.length>=1?Object(O.jsx)(O.Fragment,{children:u.map((function(e){return Object(O.jsx)(y,Object(s.a)({},e),e._id)}))}):Object(O.jsx)(O.Fragment,{children:Object(O.jsx)("h1",{children:"You haven't uploaded any songs yet"})})})]})}function F(e){var t=Object(c.useState)(""),n=Object(i.a)(t,2),r=n[0],a=n[1],s=Object(c.useState)(""),o=Object(i.a)(s,2),u=o[0],l=o[1],b=e.match.params.id;Object(c.useEffect)((function(){var e=function(){var e=Object(m.a)(x.a.mark((function e(t){var n;return x.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d.getSong(t);case 2:n=e.sent,a(n.title),l(n.author);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();e(b)}),[b]);return Object(O.jsxs)("div",{className:"secondaryContainer",children:[Object(O.jsx)("h3",{children:"Edit song"}),Object(O.jsxs)("form",{onSubmit:function(t){t.preventDefault();var n={title:r,author:u};j.a.put("/api/".concat(b),n).then((function(){e.history.push("/songs/".concat(b))})).catch((function(e){return console.log(e)}))},className:"baseForm",children:[Object(O.jsx)("label",{htmlFor:"title",children:"Title:"}),Object(O.jsx)("input",{type:"text",name:"title",value:r,onChange:function(e){return a(e.target.value)}}),Object(O.jsx)("label",{htmlFor:"author",children:"Author: "}),Object(O.jsx)("input",{type:"text",name:"author",value:u,onChange:function(e){return l(e.target.value)}}),Object(O.jsx)("button",{type:"submit",children:"Update this project"})]})]})}var E=function(e){var t=Object(c.useState)(e.search),n=Object(i.a)(t,2),r=n[0],a=n[1],u=Object(c.useState)(e.user),l=Object(i.a)(u,2),j=l[0],b=l[1],h=function(e){b(e)};return Object(O.jsxs)("div",{className:"App",children:[Object(O.jsx)(w,{user:j,setUser:b,search:r,setSearch:a,currentPage:e}),Object(O.jsx)("div",{className:"mainContainer",children:Object(O.jsxs)(o.c,{children:[Object(O.jsx)(o.a,{exact:!0,path:"/",render:function(e){return Object(O.jsx)(S,{search:r,setSearch:a})}}),Object(O.jsx)(o.a,{exact:!0,path:"/songs/add",render:j?function(e){return Object(O.jsx)(f,{user:j,setUser:b})}:function(e){return Object(O.jsx)(k,Object(s.a)({setUser:h},e))}}),Object(O.jsx)(o.a,{exact:!0,path:"/songs/:id",render:j?function(e){return Object(O.jsx)(N,Object(s.a)({user:j},e))}:function(e){return Object(O.jsx)(N,Object(s.a)({user:null},e))}}),Object(O.jsx)(o.a,{exact:!0,path:"/signup",render:function(e){return Object(O.jsx)(C,Object(s.a)({setUser:h},e))}}),Object(O.jsx)(o.a,{exact:!0,path:"/login",render:function(e){return Object(O.jsx)(k,Object(s.a)({setUser:h},e))}}),Object(O.jsx)(o.a,{exact:!0,path:"/mysongs",render:function(e){return Object(O.jsx)(U,{user:j,setUser:b})}}),Object(O.jsx)(o.a,{exact:!0,path:"/songs/edit/:id",component:F}),Object(O.jsx)(o.a,{component:function(){return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("h1",{children:"404 - Not Found"}),"  ",Object(O.jsx)(v.b,{to:"/",children:"Return home"})]})}}),"2"]})})]})};j.a.get("/api/auth/loggedin").then((function(e){var t=e.data;a.a.render(Object(O.jsx)(v.a,{children:Object(O.jsx)(E,{user:t,search:""})}),document.getElementById("root"))}))}},[[68,1,2]]]);
//# sourceMappingURL=main.27058f0c.chunk.js.map