(this["webpackJsonpfile-upload-client"]=this["webpackJsonpfile-upload-client"]||[]).push([[0],{39:function(e,t,n){},65:function(e,t,n){},67:function(e,t,n){"use strict";n.r(t);var c=n(1),r=n(31),s=n.n(r),a=(n(39),n(10)),o=n(3),i=n(2),u=n(21),l=n(15),j=n.n(l),b=j.a.create({baseURL:"/api"}),h=function(e){throw e},d={service:b,deleteSong:function(e){return b.delete("/".concat(e)).then((function(e){return e.data})).catch(h)},handleUpload:function(e){return b.post("/upload",e).then((function(e){return e.data})).catch(h)},saveNewSong:function(e){return b.post("/songs/create",e).then((function(e){return e.data})).catch(h)},findAllSongs:function(){return b.get("/songs").then((function(e){return e.data})).catch(h)},getSong:function(e){return b.get("/songs/".concat(e)).then((function(e){return e.data})).catch(h)},signup:function(e,t){return b.post("/auth/signup",{username:e,password:t}).then((function(e){return e.data})).catch((function(e){return e.response.data}))},login:function(e,t){return b.post("/auth/login",{username:e,password:t}).then((function(e){return console.log("service.js login response:",e),e.data})).catch((function(e){return e.response.data}))},logout:function(){return b.delete("/auth/logout").then((function(e){return e.data})).catch((function(e){return e.response.data}))}},O=n(0);var g=function(e){var t=Object(i.f)(),n=e.user._id,r=Object(c.useState)(""),s=Object(o.a)(r,2),a=s[0],l=s[1],j=Object(c.useState)(""),b=Object(o.a)(j,2),h=b[0],g=b[1],p=Object(c.useState)(""),f=Object(o.a)(p,2),x=f[0],m=f[1],v=Object(c.useState)(n),S=Object(o.a)(v,2),y=S[0],w=(S[1],Object(c.useState)("")),U=Object(o.a)(w,2),C=U[0],k=U[1],E=Object(c.useState)([]),F=Object(o.a)(E,2),D=F[0],_=F[1],L=Object(c.useState)(null),A=Object(o.a)(L,2),N=A[0],T=A[1],z=Object(c.useState)(0),B=Object(o.a)(z,2),I=B[0],P=B[1],R=Object(c.useState)(null),H=Object(o.a)(R,2),J=H[0],M=H[1],q=Object(O.jsx)("button",{type:"submit",children:"Save new song"}),G=Object(O.jsx)("p",{children:"Loading"}),K=Object(O.jsx)("p",{children:"upload your file"});return Object(c.useEffect)((function(){return null!==N&&_(Object(u.a)(D).filter((function(e){return e!==N}))),function(){T(null)}}),[D,N]),Object(O.jsxs)("div",{children:[Object(O.jsx)("h2",{children:"New Song"}),Object(O.jsxs)("form",{onSubmit:function(e){e.preventDefault(),d.saveNewSong({title:a,author:h,songUrl:x,createdBy:y,tags:D}).then((function(e){console.log("added new song: ",e),t.push("/songs/".concat(e._id))})).catch((function(e){return console.log("Error while adding the new song: ",e)}))},children:[Object(O.jsxs)("label",{children:["Name",Object(O.jsx)("input",{type:"text",name:"title",value:a,onChange:function(e){return l(e.target.value)}})]}),Object(O.jsx)("label",{children:"Author"}),Object(O.jsx)("textarea",{type:"text",name:"author",value:h,onChange:function(e){return g(e.target.value)}}),Object(O.jsx)("input",{type:"file",onChange:function(e){console.log("The file to be uploaded is: ",e.target.files[0]),P(1);var t=new FormData;t.append("songUrl",e.target.files[0]),d.handleUpload(t).then((function(e){m(e.secure_url),P(2)})).catch((function(e){return console.log("Error while uploading the file: ",e)}))}}),Object(O.jsx)("div",{children:I>1?q:I>0?G:K})]}),D.length<5?Object(O.jsxs)("form",{onSubmit:function(e){e.preventDefault(),M(null),_((function(e){return[C].concat(Object(u.a)(e)).map((function(e){return e.toLowerCase()})).filter((function(e,t,n){return n.indexOf(e)===t||(M("".concat(e," is already a tag")),!1)}))})),k("")},children:[Object(O.jsxs)("label",{children:["Tags",Object(O.jsx)("input",{type:"text",name:"tag",value:C,onChange:function(e){return k(e.target.value)}})]}),Object(O.jsx)("button",{type:"submit",children:"Add Tag"})]}):Object(O.jsx)("p",{children:"max tags number reached"}),J&&Object(O.jsx)("p",{children:J}),D.map((function(e){return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("p",{children:e}),Object(O.jsx)("form",{onSubmit:function(e){return T(e)},children:Object(O.jsx)("button",{type:"submit",children:"x"})})]})}))]})},p=(n(65),n(7));function f(e){var t=e.title,n=e._id,c=e.songUrl,r=e.author;return Object(O.jsxs)("div",{children:[Object(O.jsx)(p.b,{to:"/songs/".concat(n),children:Object(O.jsx)("h3",{children:t})}),Object(O.jsx)("a",{href:c,download:"".concat(t,"_").concat(r,".mid"),children:"Download"})]})}var x=function(e){var t=Object(c.useState)([]),n=Object(o.a)(t,2),r=n[0],s=n[1],i=Object(c.useState)(""),u=Object(o.a)(i,2),l=u[0],j=u[1],b=Object(c.useState)({title:!0,author:!0}),h=Object(o.a)(b,2),g=h[0],p=h[1];Object(c.useEffect)((function(){d.findAllSongs().then((function(e){s(e)})).catch((function(e){return console.log("Error while uploading the file: ",e)}))}),[]);var x=l.split(" "),m=1===x.length?x:x.join(".*"),v=new RegExp(m,"i"),S=1===x.length?x:x.join(".*")+"|"+x.reverse().join(".*"),y=new RegExp(S,"i"),w=r.filter((function(e){return!0===g.title&&!0===g.author?v.test(e.title)||y.test(e.title)||v.test(e.author)||y.test(e.author):!1===g.title&&!0===g.author?v.test(e.author)||y.test(e.author):!0===g.title&&!1===g.author?v.test(e.title)||y.test(e.title):r}));return Object(O.jsxs)(O.Fragment,{children:[Object(O.jsx)("h1",{children:"List of Songs"}),Object(O.jsxs)("div",{className:"filter",children:[Object(O.jsx)("label",{children:"Search: "}),Object(O.jsx)("input",{type:"text",name:"search",value:l,onChange:function(e){return j(e.target.value)}})]}),Object(O.jsxs)("label",{children:["Search by Title",Object(O.jsx)("input",{name:"title",type:"checkbox",checked:g.title,onChange:function(e){return p(Object(a.a)(Object(a.a)({},g),{},{title:e.target.checked}))}})]}),Object(O.jsx)("br",{}),Object(O.jsxs)("label",{children:["Search by Author",Object(O.jsx)("input",{name:"author",type:"checkbox",checked:g.author,onChange:function(e){return p(Object(a.a)(Object(a.a)({},g),{},{author:e.target.checked}))}})]}),w.map((function(e){return Object(O.jsx)(f,Object(a.a)({},e),e._id)}))]})};function m(e){var t=Object(i.g)().pathname;return Object(O.jsx)("nav",{children:e.user?Object(O.jsxs)(O.Fragment,{children:["/"!==t&&Object(O.jsx)(p.b,{to:"/",children:Object(O.jsx)("p",{children:"Home"})}),Object(O.jsx)(p.b,{to:"/",onClick:function(){d.logout().then((function(){e.setUser(null)}))},children:Object(O.jsx)("p",{children:"Logout"})}),"/songs/add"!==t&&Object(O.jsx)(p.b,{to:"/songs/add",children:Object(O.jsx)("p",{children:"Upload Song"})})]}):Object(O.jsxs)(O.Fragment,{children:["/"!==t&&Object(O.jsx)(p.b,{to:"/",children:Object(O.jsx)("p",{children:"Home"})}),"/login"===t&&Object(O.jsx)("p",{children:"don't have an account?"}),"/signup"!==t&&Object(O.jsx)(O.Fragment,{children:Object(O.jsx)(p.b,{to:"/signup",children:Object(O.jsx)("p",{children:"Sign up"})})}),"/signup"!==t&&"/login"!==t&&Object(O.jsx)("p",{children:"or"}),"/signup"===t&&Object(O.jsx)("p",{children:"already  a user?"}),"/login"!==t&&Object(O.jsx)(O.Fragment,{children:Object(O.jsx)(p.b,{to:"/login",children:Object(O.jsx)("p",{children:"Log in"})})}),"/signup"!==t&&"/login"!==t&&Object(O.jsx)("p",{children:"to upload a song "})]})})}var v=n(20),S=n.n(v),y=n(34);function w(e){var t=Object(i.f)();console.log(t);var n=Object(c.useState)(null),r=Object(o.a)(n,2),s=r[0],a=r[1],u=Object(c.useState)({body:null}),l=Object(o.a)(u,2),j=l[0],b=l[1],h=e.user?e.user._id:"",g=e.match.params.id,p=function(){var e=Object(y.a)(S.a.mark((function e(t){var n;return S.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,d.getSong(t);case 3:n=e.sent,console.log("song retrieved:",n),a(n),e.next=11;break;case 8:return e.prev=8,e.t0=e.catch(0),e.abrupt("return",console.log(e.t0));case 11:case"end":return e.stop()}}),e,null,[[0,8]])})));return function(t){return e.apply(this,arguments)}}();return Object(c.useEffect)((function(){p(g)}),[g]),Object(c.useEffect)((function(){var e=document.createElement("script");return e.src="https://cdn.jsdelivr.net/combine/npm/tone@14.7.58,npm/@magenta/music@1.22.1/es6/core.js,npm/focus-visible@5,npm/html-midi-player@1.4.0",e.async=!0,document.body.appendChild(e),function(){document.body.removeChild(e)}}),[]),Object(c.useEffect)((function(){s&&b({body:Object(O.jsx)(O.Fragment,{children:Object(O.jsxs)("section",{id:"player2",children:[Object(O.jsx)("midi-visualizer",{type:"piano-roll",src:s.songUrl}),Object(O.jsx)("midi-player",{src:s.songUrl,visualizer:"#player2 midi-visualizer"})]})})})}),[s]),Object(O.jsx)("div",{children:s&&Object(O.jsxs)("div",{children:[Object(O.jsx)("h1",{children:s.title}),Object(O.jsx)("h3",{children:s.author}),Object(O.jsx)("p",{children:s.songUrl}),Object(O.jsx)("a",{href:s.songUrl,download:"".concat(s.title,"_").concat(s.author,".mid"),children:"Download"}),h===s.createdBy&&Object(O.jsxs)("button",{onClick:function(){return function(e){try{var n=d.deleteSong(e).then;console.log("song deleted:",n),t.push("/")}catch(c){return console.log(c)}}(s._id)},children:["Delete ",s.title]}),null!==j.body?Object(O.jsx)("div",{children:j.body}):Object(O.jsx)("p",{children:"nothing to play"})]})})}function U(e){var t=Object(c.useState)(""),n=Object(o.a)(t,2),r=n[0],s=n[1],a=Object(c.useState)(""),i=Object(o.a)(a,2),u=i[0],l=i[1],j=Object(c.useState)(""),b=Object(o.a)(j,2),h=b[0],g=b[1];return Object(O.jsxs)("div",{children:[Object(O.jsx)("h3",{children:"Sign up"}),Object(O.jsxs)("form",{onSubmit:function(t){t.preventDefault(),d.signup(r,u).then((function(t){console.log(t),t.message?(s(""),l(""),g(t.message),console.log(t.message)):(console.log(r),e.setUser(t),e.history.push("/"))})).catch((function(e){return console.log(e)}))},children:[Object(O.jsx)("label",{htmlFor:"username",children:"Username: "}),Object(O.jsx)("input",{type:"text",name:"username",value:r,onChange:function(e){return s(e.target.value)}}),Object(O.jsx)("label",{htmlFor:"password",children:"Password: "}),Object(O.jsx)("input",{type:"password",name:"password",value:u,onChange:function(e){return l(e.target.value)}}),Object(O.jsx)("button",{type:"submit",children:"Sign Up \u270d\ufe0f"}),h&&Object(O.jsx)("h3",{children:h})]})]})}function C(e){var t=Object(c.useState)(""),n=Object(o.a)(t,2),r=n[0],s=n[1],a=Object(c.useState)(""),i=Object(o.a)(a,2),u=i[0],l=i[1],j=Object(c.useState)(""),b=Object(o.a)(j,2),h=b[0],g=b[1];return Object(O.jsxs)("div",{children:[Object(O.jsx)("h3",{children:"Log in"}),Object(O.jsxs)("form",{onSubmit:function(t){t.preventDefault(),console.log("handleSubmit login.js ",r,u),d.login(r,u).then((function(t){console.log("handlesubmit service.login response:",t),t.message?(g(t.message),s(""),l("")):(e.setUser(t),e.history.push("/"))}))},children:[Object(O.jsx)("label",{htmlFor:"username",children:"Username: "}),Object(O.jsx)("input",{type:"text",name:"username",value:r,onChange:function(e){return s(e.target.value)}}),Object(O.jsx)("label",{htmlFor:"password",children:"Password: "}),Object(O.jsx)("input",{type:"password",name:"password",value:u,onChange:function(e){return l(e.target.value)}}),Object(O.jsx)("button",{type:"submit",children:"Log in\u270d\ufe0f"}),h&&Object(O.jsx)("h3",{children:h})]})]})}var k=function(e){var t=Object(c.useState)(e.user),n=Object(o.a)(t,2),r=n[0],s=n[1],u=Object(i.f)(),l=function(e){s(e)};return console.log("user in app.js",r),Object(O.jsxs)("div",{className:"App",children:[Object(O.jsx)("h1",{children:"ArchiMIDIs"}),Object(O.jsx)(m,{user:r,setUser:s,currentPage:e}),Object(O.jsxs)(i.c,{children:[Object(O.jsx)(i.a,{exact:!0,path:"/",component:x}),Object(O.jsx)(i.a,{exact:!0,path:"/songs/add",render:r?function(e){return Object(O.jsx)(g,{user:r,setUser:s})}:u.push("/login")}),Object(O.jsx)(i.a,{exact:!0,path:"/songs/:id",render:r?function(e){return Object(O.jsx)(w,Object(a.a)({user:r},e))}:function(e){return Object(O.jsx)(w,Object(a.a)({user:null},e))}}),Object(O.jsx)(i.a,{exact:!0,path:"/signup",render:function(e){return Object(O.jsx)(U,Object(a.a)({setUser:l},e))}}),Object(O.jsx)(i.a,{exact:!0,path:"/login",render:function(e){return Object(O.jsx)(C,Object(a.a)({setUser:l},e))}})]})]})};j.a.get("/api/auth/loggedin").then((function(e){console.log("response in: ",e);var t=e.data;s.a.render(Object(O.jsx)(p.a,{children:Object(O.jsx)(k,{user:t})}),document.getElementById("root"))}))}},[[67,1,2]]]);
//# sourceMappingURL=main.f8245db0.chunk.js.map